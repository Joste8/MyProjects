{% set purchasedItems = [] %}
{% for purchase in entity.instance.purchases %}
    {% set purchasedItems = purchasedItems|merge([purchase.itemName]) %}
{% endfor %}

<div class="card border-primary mb-4 shadow-sm" style="border-left: 5px solid #007bff;">
    <div class="card-body">
        <h5 class="card-title text-primary"><i class="fas fa-lightbulb"></i> Next Purchase Suggestions</h5>
        <p class="text-muted small">Based on your history, you might also like these:</p>
        
        <div class="d-flex flex-wrap gap-2">
            {% set suggested = false %}
            
            {% for product in field.customOptions.get('allProducts')|default([]) %}
                {% if product.name not in purchasedItems %}
                    {% set suggested = true %}
                    
                    {# Dynamic URL generation for each product #}
                    {% set productUrl = ea_url()
                        .setController('App\\Controller\\Admin\\ProductCrudController')
                        .setAction('detail')
                        .setEntityId(product.id) 
                    %}
                    
                    <a href="{{ productUrl }}" 
                       class="p-2 border rounded bg-light mr-2 mb-2 shadow-sm text-decoration-none hover-shadow" 
                       style="min-width: 140px; display: inline-block;">
                        <strong class="text-dark d-block">{{ product.name }}</strong>
                        <span class="text-info small">View Product â†’</span>
                    </a>
                {% endif %}
            {% endfor %}

            {% if not suggested %}
                <p class="text-muted italic small">No new suggestions available at the moment.</p>
            {% endif %}
        </div>
    </div>
</div>

<style>
    .hover-shadow:hover {
        background-color: #f8f9fa !important;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1) !important;
        transition: 0.2s;
    }
</style>