{% set purchaseCounts = {} %}

{% for purchase in entity.instance.purchases %}
    {% set itemName = purchase.itemName %}
    {% if purchaseCounts[itemName] is defined %}
        {% set purchaseCounts = purchaseCounts|merge({ (itemName): purchaseCounts[itemName] + 1 }) %}
    {% else %}
        {% set purchaseCounts = purchaseCounts|merge({ (itemName): 1 }) %}
    {% endif %}
{% endfor %}

<div class="card border-primary mb-4 shadow-sm" style="border-left: 5px solid #007bff;">
    <div class="card-body">
        <h5 class="card-title text-primary"><i class="fas fa-lightbulb"></i> Next Purchase Suggestions</h5>
        <p class="text-muted small">Based on frequent purchases, this customer is likely to buy:</p>
        
        <div class="d-flex flex-wrap gap-2">
            {% set suggested = false %}
            {% for item, count in purchaseCounts %}
                {% if count >= 1 %}
                    {% set suggested = true %}
                    <div class="p-2 border rounded bg-light mr-2 mb-2 shadow-sm">
                        <strong class="text-dark">{{ item }}</strong>
                        <div class="text-success small">Confidence Level: {{ (count * 20) > 100 ? 100 : (count * 20) }}%</div>
                    </div>
                {% endif %}
            {% endfor %}

            {% if not suggested %}
                <p class="text-muted italic">New customer - No suggestions available yet.</p>
            {% endif %}
        </div>
    </div>
</div>